services:
  app:
    image: payrillium/payrillium1:2.1.0_b31
    container_name: app
    restart: unless-stopped
    ports:
      - "8338:80"
      - "8339:443"
   
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /var/docker-data/appdata/images:/var/www/html/storage/app/public/images
      - /var/docker-save/music:/var/www/html/storage/app/public/music
      - /var/docker-data/appdata/data/import_files:/var/www/html/storage/app/public/data/import_files
      - /usr/local/var/urbackup/tokens:/var/www/html/storage/app/public/tokens
      - /var/docker-data/appdata/tickets:/var/www/html/storage/app/public/tickets
      - /var/docker-data/appdata/signature:/var/www/html/storage/app/public/signature
      - /var/docker-data/appdata/logs/laravel:/var/www/html/storage/logs
      - /var/docker-save/camera:/var/www/html/storage/app/public/camera
      - /var/docker-config:/var/www/html/docker
      - /var/docker-data/appdata/data/import_templates:/var/www/html/storage/app/public/data/import_templates
    depends_on:
      - db
      - redis
      - psdk
      - psdk-pax
      - netscan
      - updater
    networks:
      - payrillium-net
    # Info para CasaOS (solo para la app principal)
    x-casaos:
      ports:
        - container: "80"
          description:
            en_us: "HTTP port for Payrillium UI"
        - container: "443"
          description:
            en_us: "HTTPS port for Payrillium UI"
      volumes:
        - container: /var/www/html/storage/app/public/images
          description:
            en_us: "Product and system images"
        - container: /var/www/html/storage/app/public/music
          description:
            en_us: "Music files"
        - container: /var/www/html/storage/app/public/data/import_files
          description:
            en_us: "Imported data files"
        - container: /var/www/html/storage/app/public/tokens
          description:
            en_us: "UrBackup tokens"
        - container: /var/www/html/storage/app/public/tickets
          description:
            en_us: "Tickets storage"
        - container: /var/www/html/storage/app/public/signature
          description:
            en_us: "Signatures storage"
        - container: /var/www/html/storage/logs
          description:
            en_us: "Laravel logs"
        - container: /var/www/html/storage/app/public/camera
          description:
            en_us: "Camera uploads"
        - container: /var/www/html/docker
          description:
            en_us: "Payrillium docker config"
        - container: /var/www/html/storage/app/public/data/import_templates
          description:
            en_us: "Import templates"

  db:
    image: postgres:16.1-alpine
    container_name: db
    restart: unless-stopped
    ports:
      - "5432:5432"
    volumes:
      - payrillium-db:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: app
      POSTGRES_USER: root
      POSTGRES_PASSWORD: rootpassword
    networks:
      - payrillium-net

  redis:
    image: redis:7-alpine
    container_name: redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    networks:
      - payrillium-net

  psdk:
    image: payrillium/payrillium:psdk.verifone_3.9.14
    container_name: psdk
    restart: unless-stopped
    ports:
      - "8082:8082"
    networks:
      - payrillium-net

  psdk-pax:
    image: payrillium/payrillium:psdk.pax_1.13.24_b1
    container_name: psdk-pax
    restart: unless-stopped
    ports:
      - "8085:8085"
    networks:
      - payrillium-net

  netscan:
    image: payrillium/payrillium:netscan_2.1.1
    container_name: netscan
    restart: unless-stopped
    ports:
      - "8383:8383"
    networks:
      - payrillium-net

  updater:
    image: payrillium/payrillium:updater_4.0.0
    container_name: updater
    restart: unless-stopped
    ports:
      - "8336:8336"
    networks:
      - payrillium-net

networks:
  payrillium-net:
    driver: bridge

volumes:
  payrillium-db:

x-casaos:
  architectures: [amd64]
  main: app
  author: Payrillium
  category: Payrillium
  title:
    en_us: Payrillium Proton 2.1.0_b31
  description:
    en_us: Payrillium POS server (Proton app + internal services).
  icon: https://raw.githubusercontent.com/Payrillium/payrillium-store/main/proton.png
  thumbnail: https://raw.githubusercontent.com/Payrillium/payrillium-store/main/proton.png
  tagline:
    en_us: Payrillium Proton with full service stack
  index: /
  scheme: http
  port_map: "8338"
